<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> | robonovotny</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="https://novotnyr.github.io/asciidoctor.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body);
        });
    </script>

<header>

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="https://novotnyr.github.io/">/home/robonovotny</a>
      </li>
      

      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title"></span></h1>


<p class="terms">
  
  
  
  
  
</p>
</div>



<main>
<p>Ak chceme v Jave 11 alebo novšej zverejniť webovú službu v protokole SOAP, máme k
dispozícii základné špecifikáciu <a href="https://jakarta.ee/specifications/xml-web-services/4.0/%5BJakarta">https://jakarta.ee/specifications/xml-web-services/4.0/[Jakarta</a> XML Web Services 4.0].</p>
<p>Tá:</p>
<ul>
<li>je pod dáždnikom špecifikácie <a href="https://blog.payara.fish/whats-new-in-jakarta-ee-10%5BJakarta">https://blog.payara.fish/whats-new-in-jakarta-ee-10[Jakarta</a> EE 10]</li>
<li>je evolúciou z overenej technológie Java XML Web Service 2.0 (JAX-WS 2.0)</li>
<li>vyžaduje aspoň Javu 11</li>
<li>funguje bez problémov aj na Jave 17 a budúcich technológiách</li>
<li>je postavená na balíčkoch <code>jakarta.</code>, ktoré sa budú naďalej vyvíjať a majú podporu v moderných technológiách.</li>
</ul>
<p>S</p>
<p>tačí si
vybrať jednu zo štyroch knižníc alebo bezpočtu aplikačných serverov, v
ktorej službu implementujeme.</p>
<p>Rokmi overená istota, ktorú si ukážeme, je SOAP služba implementovaná v
knižnici <em>Metro</em>.</p>
<p>Ukážeme si:</p>
<p>[arabic]
. Vytvorenie serverovskej časti: od kódu ku automaticky generovanému
popisu služby cez WSDL.
. Vytvorenie klientskej časti: vygenerovaním kódu klienta na základe
WSDL.</p>
<p>== Historické okienko</p>
<p>Knižnica <a href="https://github.com/eclipse-ee4j/metro-jax-ws%5BMetro%5D">https://github.com/eclipse-ee4j/metro-jax-ws[Metro]</a> je
odpradávna referenčnou implementáciou JAX-WS 2.0/JSR 224.</p>
<p>Programátorov však viac zasiahli následné zmeny:</p>
<ul>
<li><em>Java 6 (2006)</em> pridala podporu pre SOAP do základnej knižnice. Kód
Metra bol dodávaný priamo s Javou.</li>
<li><em>Java 9 (sept. 2017)</em> vyhlásila JAX-WS 2.0 v základnej knižnici za
zrelý na odstránenie.</li>
<li><em>Java 11 (sept. 2018)</em> už JAX-WS 2.0 neobsahuje.</li>
</ul>
<p><em>Metro</em> prešlo aj politickými zmenami: pôvodne bolo vyvíjané v rámci
projektu <em>Glassfish</em>, ale na konci októbra 2018 bolo presunuté pod
nadáciu Eclipse,</p>
<p>== Serverovská časť</p>
<p>Server vytvoríme v štyroch krokoch:</p>
<p>[arabic]
. Pridáme závislosti na knižnici Metro.
. Vytvoríme triedu so serverovským kódom.
. Pridáme anotáciu <code>@WebService</code>
. Pripravíme triedu s metódou <code>main()</code>, kde spustíme server a
publikujeme ho cez HTTP.</p>
<p>=== Závislosti v Mavene</p>
<p>Serverovskú časť vytvoríme s použitím Mavenu, ktorý zavedie všetky nutné
knižnice. Do <code>pom.xml</code> stačí pridať jedinú závislosť pre Metro.</p>
<h2 id="sourcexml">[source,xml]</h2>
<!-- raw HTML omitted -->
<p>Netreba sa čudovať, hoci názov skupiny (<em>group id</em>) je staručký
<code>com.sun.xml.ws</code>, samotný kód verzie 2.3.3 už pochádza z nadácie
Eclipse.</p>
<p>=== Nastavenie použitia Javy 11</p>
<p>V <code>pom.xml</code> nezabudnime zapnúť podporu pre Javu 11:</p>
<h2 id="sourcexml-1">[source,xml]</h2>
<!-- raw HTML omitted -->
<p>=== Kód serverovskej časti</p>
<p>Serverovská časť je úplne bežná trieda, s úplne bežnými metódami:</p>
<h2 id="sourcejava">[source,java]</h2>
<p>package sk.upjs.ics.kopr.soap.server;</p>
<p>import javax.jws.WebService;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;</p>
<p>@WebService
public class DefaultTermService {
private List<!-- raw HTML omitted --> terms = new ArrayList<!-- raw HTML omitted -->();</p>
<pre><code>public DefaultTermService() {
    terms.add(new Term(LocalDate.of(2020, 12, 12), &quot;UINF/PAZ1c&quot;, 100));
    terms.add(new Term(LocalDate.of(2020, 12, 15), &quot;UINF/PAZ1c&quot;, 75));
    terms.add(new Term(LocalDate.of(2021, 1, 5), &quot;UINF/TVY1a&quot;, 50));
}

public List&lt;Term&gt; getTerms(String courseCode) {
    return terms.stream()
            .filter(term -&gt; term.getCourseCode().equals(courseCode))
            .collect(Collectors.toList());
}
</code></pre>
<h2 id="heading">}</h2>
<p>=== Pridanie anotácie <code>@WebService</code></p>
<p>Ak chceme zverejniť triedu ako SOAPovú webovú službu, dodáme anotáciu
<code>@javax.jws.WebService</code>.</p>
<p>&hellip;.
@WebService
public class DefaultTermService {
&hellip;.</p>
<p>=== Publikovanie služby</p>
<p>Službu vypublikujeme zavolaním statickej metódy <code>publish</code> na triede
<code>Endpoint</code>.</p>
<h2 id="sourcejava-1">[source,java]</h2>
<p>import javax.xml.ws.Endpoint;</p>
<h2 id="heading-1">public class Server {
public static void main(String[] args) {
Endpoint.publish(&ldquo;http://localhost:8888/terms&rdquo;, new DefaultTermService());
}
}</h2>
<p>Publikovanie potrebuje dva parametre:</p>
<ul>
<li>URL adresu, na ktorej pobeží server. V ukážke máme lokálny server na
porte 8888.</li>
<li>objekt služby s anotáciou <code>@WebService</code>, ktorá obslúži požiadavky.</li>
</ul>
<p>Triedu s metódou <code>main()</code> teraz môžeme spustiť, čím naštartujeme interný
server nad HTTP. Cez prehliadač môžeme navštíviť adresu
http://localhost:8888/terms. Uvidíme informačnú stránku, ktorá obsahuje
odkaz na popisovač webovej služby WSDL.</p>
<p>==== Chybové hlášky?</p>
<p>Pri spustení možno uvidíme varovanie:</p>
<p>&hellip;.
WARNING: Illegal reflective access by com.sun.xml.ws.model.Injector (file:/Users/novotnyr/.m2/repository/com/sun/xml/ws/jaxws-rt/2.3.2/jaxws-rt-2.3.2.jar) to method java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int)
&hellip;.</p>
<p>Ide o známu <a href="https://github.com/eclipse-ee4j/metro-jax-ws/issues/60%5Bchybu">https://github.com/eclipse-ee4j/metro-jax-ws/issues/60[chybu</a>
č. 60] v knižnici Metro, ktorú stačí ignorovať.</p>
<p>== Klientska časť</p>
<p>Server zverejnil svoju službu na adrese <code>http://localhost:8888/terms</code>, a
zároveň poskytol aj WSDL. Vďaka tomu vieme automaticky vygenerovať
klientsky kód!</p>
<p>Vytvoríme si extra projekt, <code>metro-java11-client</code>, v ktorom budeme
udržiavať zdrojáky klientskej časti.</p>
<p>=== Kde je <code>wsimport</code>?</p>
<p>V predošlých verziách Javy existoval nástroj <code>wsimport</code>. Ten už v bežnej
distribúcii nie je tak ľahko dostupný (zmenil sa na shellskripty).</p>
<p>Namiesto neho použijeme mavenovský plugin.</p>
<p>==== Generujeme zdrojáky mavenovským pluginom</p>
<p>Na generovanie použijeme mavenovský plugin <code>jaxws-maven-plugin</code>. Do
klientskeho <code>pom.xml</code> dodáme:</p>
<h2 id="sourcexml-2">[source,xml]</h2>
<!-- raw HTML omitted -->
<p>Samozrejme, predpokladáme, že i klientsky projekt obsahuje:</p>
<ul>
<li>závislosť na <code>com.sun.xml.ws:jaxws-rt:2.3.3</code></li>
<li>a je pripravený pre zostavenie nad Javou 11</li>
</ul>
<p>Nechajme si vygenerovať zdrojové kódy pre klienta:</p>
<p>&hellip;.
mvn clean jaxws:wsimport compile
&hellip;.</p>
<p>Plugin vygeneruje niekoľko súborov, ktoré sa ocitnú v adresári
<code>target/generated-sources/wsimport</code>. Keďže ide o automaticky generované
triedy, niektoré názvy môžu byť čudesné (napríklad
<code>DefaultTermServiceService</code>).</p>
<p>Následne ich priamo skompiluje, čím ich sprístupní v zdrojových kódoch
klienta, ktorého ihneď vytvoríme.</p>
<p>==== Použitie klienta v kóde</p>
<p>Klienta použijeme jednoducho:</p>
<h2 id="sourcejava-2">[source,java]</h2>
<h2 id="heading-2">public class Client {
public static void main(String[] args) {
DefaultTermServiceService serviceLocator = new DefaultTermServiceService();
DefaultTermService termService = serviceLocator.getDefaultTermServicePort();
List<!-- raw HTML omitted --> terms = termService.getTerms(&ldquo;UINF/PAZ1c&rdquo;);
for (Term term : terms) {
System.out.printf(&quot;%s - %d slots left\n&quot;, term.getDate(), term.getFreeSlots());
}
}
}</h2>
<p>Klient sa bude pripájať k URL, ktorá sa prevezme z WSDL.</p>
<p>== Záver</p>
<p>Takúto podporu webových služieb môžeme považovať za vhodnú pre mnoho
jednoduchých prípadov (jednoduchá trieda, málo metód, HTTP binding,
vyhovujúci HTTP server, žiadne závislosti). Samozrejme, v komplexnejších
prípadoch si asi s touto verziou nevystačíme a budeme potrebovať použiť
niektorú z ťažkotonážnejších implementácií, alebo jej zahrnutie do
aplikačného servera s Java EE.</p>
<p>Napriek tomu je však už i takáto jednoduchá podpora minimálne
ekvivalentná s použitím technológie RMI.</p>
<p>== Ukážkové projekty</p>
<ul>
<li><em>Serverovský</em> repozitár
<a href="https://github.com/novotnyr/kopr-soap-server-2020%5Bnovotnyr/kopr-soap-server-2020)%5D">https://github.com/novotnyr/kopr-soap-server-2020[novotnyr/kopr-soap-server-2020)]</a>
obsahuje SOAP server</li>
<li><em>Klientsky</em> repozitár
<a href="https://github.com/novotnyr/kopr-soap-server-2020%5Bnovotnyr/kopr-soap-klient-2020)%5D">https://github.com/novotnyr/kopr-soap-server-2020[novotnyr/kopr-soap-klient-2020)]</a>
obsahuje podporu pre generovanie kódu klienta s ukážkovým použitím.</li>
</ul>

</main>

    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

      
    </footer>
  </body>
</html>

