<!DOCTYPE html>
<html lang="en-us">
  <head>

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/images/site.webmanifest">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>JAXB - architektúra pre mapovanie XML na objekty | robonovotny</title>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/styles/dracula.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/go.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="https://novotnyr.github.io/asciidoctor.css">
    <header>

  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="https://novotnyr.github.io/">~/robonovotny</a>
      </li>
      

      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">JAXB - architektúra pre mapovanie XML na objekty</span></h1>

<h2 class="date">2008/01/27</h2>
<p class="terms">
  
  
  
  
  
</p>
</div>


<div class="content-wrapper">
  <main>
    <h1 id="úvod">Úvod</h1>
<blockquote>
<p>„Technológie jazyka Java a XML možno považovať za ideálne stavebné bloky pre vývoj webových služieb a aplikácií, ktoré ich využívajú. Aplikačné rozhranie <strong>Java Architecture for XML Binding</strong> (JAXB) uľahčuje prácu s XML dokumentami v Java aplikáciách.“</p>
</blockquote>
<p>Týmito slovami sumarizuje technológiu JAXB <a href="http://java.sun.com/developer/technicalArticles/WebServices/jaxb/">popisného dokumentu na stránkach Sun-u</a>.</p>
<p>JAXB umožňuje mapovanie XML dokumentov na Java objekty a to v oboch smeroch. Samozrejme, že toto mapovanie sa musí riadiť nejakými pravidlami - v tomto prípade <a href="http://www.w3.org/TR/xmlschema-0/">XML schémou</a>, ktorá popisuje štruktúru príslušného XML dokumentu.</p>
<p>JAXB je založené na špecifikácii [referenčná implementácia](<a href="http://jcp.org/en/jsr/detail?id=222">http://jcp.org/en/jsr/detail?id=222</a> | JSR-222]], ktorej [[https://jaxb.dev.java.net/ ) sa nachádza na stránkach Java.net. Túto implementáciu budeme používať aj v nasledovných príkladoch. Poznamenajme, že JAXB sa stalo súčasťou Java SE 6.</p>
<p>Zvyčajný postup práce s JAXB spočíva v nasledovných krokoch:</p>
<ol>
<li>vytvorenie XML schémy a príslušných XML dokumentov, ktoré sú na nej založené</li>
<li>vygenerovanie Java tried na základe tejto schémy. Triedy zodpovedajú jednotlivým elementom XML dokumentu.</li>
<li>deserializácia (&lsquo;&lsquo;unmarshalling&rsquo;&rsquo;) - konverzia XML dokumentu do inštancií príslušnej triedy.</li>
<li>serializácia (&lsquo;&lsquo;marshalling&rsquo;&rsquo;) - konverzia inštancie do XML reprezentácie</li>
</ol>
<h1 id="jaxb-a-klasické-objekty-bez-použitia-schémy">JAXB a klasické objekty bez použitia schémy</h1>
<h2 id="serializácia">Serializácia</h2>
<p>JAXB vo verzii 2.0 vyššie uvedené kroky značne zjednodušuje. Na rozdiel od predošlých verzií je možné serializovať a deserializovať triedy bez vytvorenia XML schémy. Kým predošlý prístup je možné nazvať „zdola nahor&quot; (od schémy cez XML k triedam), nasledovný spôsob je „zhora nadol&quot; (od triedy cez XML a schéme).</p>
<p>Ukážme si jednoduchý príklad, keď máme existujúcu triedu, ktorú chceme namapovať na XML.</p>
<p>Majme jednoduchú triedu osoby:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String firstName;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String lastName;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> Date dateOfBirth;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">float</span> weight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* gettre a settre */</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Ak túto triedu chceme serializovať do XML, potrebujeme vykonať nasledovné kroky:</p>
<ol>
<li>vytvoriť inštanciu triedy <code>JAXBContext</code>. Tá udržiava rôzne mapovania XML elementov na triedy a manažuje konkrétne implementácie objektov pre serializáciu, deserializáciu a kontrolu korektnosti serializovaných objektov. V konštruktore potrebujeme uviesť triedy, ktoré budeme serializovať - v našom prípade pôjde o jedinú triedu <code>Person</code>.</li>
<li>vytvoriť inštanciu <code>Marshaller</code>a, ktorým budeme serializovať objekty osôb</li>
<li>vytvoriť inštanciu osoby.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// vytvoríme kontext JAXB</span>
</span></span><span style="display:flex;"><span>JAXBContext jaxbContext 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">=</span> JAXBContext.<span style="color:#a6e22e">newInstance</span>(Person.<span style="color:#a6e22e">class</span>);      
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Marshaller marshaller <span style="color:#f92672">=</span> jaxbContext.<span style="color:#a6e22e">createMarshaller</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Person person <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person();
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setFirstName</span>(<span style="color:#e6db74">&#34;Janko&#34;</span>);
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setLastName</span>(<span style="color:#e6db74">&#34;Ždiebik&#34;</span>);
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setDateOfBirth</span>(<span style="color:#66d9ef">new</span> Date(1972, 3, 2));
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setWeight</span>(95);
</span></span></code></pre></div><p>Pred samotným serializovaním daného objektu ho musíme obaliť do inštancie triedy <code>JAXBElement</code>, čo je akýsi prostredník medzi Java objektom a jeho XML reprezentáciou. Pri vytváraní tohto prostredníka potrebujeme špecifikovať názov koreňového uzla s dátami serializovaného objektu, dátový typ tohto objektu a samozrejme konkrétnu inštanciu:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>JAXBElement<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> personElement 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JAXBElement<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">new</span> QName(<span style="color:#e6db74">&#34;person&#34;</span>), 
</span></span><span style="display:flex;"><span>                                Person.<span style="color:#a6e22e">class</span>, 
</span></span><span style="display:flex;"><span>                                person);
</span></span></code></pre></div><p>Názov koreňového elementu uvedieme pomocou objektu <code>QName</code>, bude ním element <code>&lt;person&gt;</code>.</p>
<p>Samotnú serializáciu vyvoláme pomocou metódy <code>marshall</code> na objekte <code>Marshaller</code>a. Uvedieme objekt, ktorý chceme serializovať (teda <code>personElement</code>) a výstupný kanál, kam ho serializujeme. Serializovať možno do súboru, na výstup typu <code>java.io.Writer</code> a podobne (viď dokumentácia k <code>Marshaller</code>u). Nasledovný kód vypíše výsledné XML na štandardný výstup.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>marshaller.<span style="color:#a6e22e">marshal</span>(personElement, System.<span style="color:#a6e22e">out</span>);
</span></span></code></pre></div><p>Vygenerované XML je však bez akéhokoľvek formátovania (všetky biele miesta sú vynechané). Čitateľnosť vygenerovaného XML môžeme zvýšiť zapnutím formátovania v marshalleri. Docieliť to môžeme nastavením príslušnej vlastnosti:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>marshaller.<span style="color:#a6e22e">setProperty</span>(Marshaller.<span style="color:#a6e22e">JAXB_FORMATTED_OUTPUT</span>, <span style="color:#66d9ef">true</span>);
</span></span></code></pre></div><p>Niekedy je vhodné zmeniť štandardné kódovanie používané v XML reprezentácii:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>marshaller.<span style="color:#a6e22e">setProperty</span>(Marshaller.<span style="color:#a6e22e">JAXB_ENCODING</span>, <span style="color:#e6db74">&#34;windows-1250&#34;</span>);
</span></span></code></pre></div><h2 id="deserializácia">Deserializácia</h2>
<p>Deserializácia prebieha podobným spôsobom. Vytvoríme inštanciu kontextu <code>JAXBContext</code>, z ktorej získame objekt <code>Unmarshaller</code>a:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>JAXBContext jaxbContext <span style="color:#f92672">=</span> JAXBContext.<span style="color:#a6e22e">newInstance</span>(Person.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>Unmarshaller unmarshaller <span style="color:#f92672">=</span> jaxbContext.<span style="color:#a6e22e">createUnmarshaller</span>();
</span></span></code></pre></div><p>Na ňom zavoláme metódu <code>unmarshall()</code>. Tá vracia <code>Object</code> reprezentujúci konkrétnu inštanciu načítanú z XML. Ale aký skutočný typ má daný objekt? To si ukážeme o chvíľu.</p>
<p>Ešte poznamenajme, že deserializácia môže načítavať XML z rôznych zdrojov, my si ukážeme načítavanie z reťazca:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String xmlPerson <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&lt;?xml version=\&#34;1.0\&#34; encoding=\&#34;windows-1250\&#34; ?&gt;\n&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&lt;person&gt;\n&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;    &lt;dateOfBirth&gt;3872-04-02T00:00:00+02:00&lt;/dateOfBirth&gt;\n&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;    &lt;firstName&gt;Janko&lt;/firstName&gt;\n&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;    &lt;lastName&gt;Ždiebik&lt;/lastName&gt;\n&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;    &lt;weight&gt;95.0&lt;/weight&gt;\n&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&lt;/person&gt;&#34;</span>;
</span></span></code></pre></div><p>Prvá vec, ktorá by nás napadla, by bolo volanie metódy nad <code>java.io.StringReader</code>om.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Object o <span style="color:#f92672">=</span> unmarshaller.<span style="color:#a6e22e">unmarshal</span>(<span style="color:#66d9ef">new</span> StringReader(xmlPerson));
</span></span></code></pre></div><p>Lenže po spustení takéhoto kódu dostaneme výnimku:</p>
<pre tabindex="0"><code>javax.xml.bind.UnmarshalException: 
  unexpected element (uri:&#34;&#34;, local:&#34;person&#34;). 
  Expected elements are (none).
</code></pre><p>Problém spočíva v tom, že nepoužívame ani XML schému, ani žiadnu inú špeciálnu konfiguráciu mapovaných tried (napr. cez anotácie). JAXB teda nevie presne, na aký dátový typ má daný XML súbor namapovať. To napravíme zavolaním dvojparametrovej metódy <code>unmarshall</code>, kde do druhého argumentu dodáme dátový typ. Musíme sa však ešte vysporiadať s jednou nepríjemnosťou: neexistuje metóda so signatúrou <code>unmarshall(Reader, Class&lt;T&gt;)</code>, ktorá by umožňovala použiť <code>StringReader</code>. To však obídeme metódou <code>unmarshall(javax.xml.transform.Source, Class&lt;T&gt;)</code>, kde vytvoríme objekt <code>Source</code> nad <code>StringReader</code>om.</p>
<p>Zároveň sa tým vyrieši otázka týkajúca sa návratového typu. V prípade serializácie sme museli obaliť inštanciu osoby objektom <code>JAXBElement</code>. Podobná zásada platí aj tu. Výsledkom deserializácie bude objekt typu <code>JAXBElement&lt;Person&gt;</code>, ktorý bude v sebe obsahovať inštanciu osoby:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Source source <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StreamSource(<span style="color:#66d9ef">new</span> StringReader(xmlPerson));
</span></span><span style="display:flex;"><span>JAXBElement<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> personElement 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">=</span> unmarshaller.<span style="color:#a6e22e">unmarshal</span>(source, Person.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//získame osobu a vypíšeme ju</span>
</span></span><span style="display:flex;"><span>Person person <span style="color:#f92672">=</span> personElement.<span style="color:#a6e22e">getValue</span>();
</span></span><span style="display:flex;"><span>System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(person);
</span></span></code></pre></div><h1 id="jaxb-a-anotované-objekty-bez-použitia-schémy">JAXB a anotované objekty bez použitia schémy</h1>
<p>V predošlej sekcii sme serializovali a deserializovali bežné Java objekty (POJOs). Niekedy je však potrebné proces serializácie a deserializácie viac prispôsobiť svojim potrebám. Na tento účel slúžia anotácie, ktorými vieme podrobne nakonfigurovať príslušnú triedu.</p>
<p>Základnou anotáciou je <code>XmlRootElement</code>. Takto anotovaná trieda bude serializovaná v podobe XML podstromu.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@XmlRootElement</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String firstName;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String lastName;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> Date dateOfBirth;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">float</span> weight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* gettre a settre */</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Serializácia takejto triedy sa potom zjednoduší: nemusíme totiž obaľovať inštanciu osôb do <code>JAXBElement</code>ov.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>JAXBContext jaxbContext <span style="color:#f92672">=</span> JAXBContext.<span style="color:#a6e22e">newInstance</span>(Person.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>Marshaller marshaller <span style="color:#f92672">=</span> jaxbContext.<span style="color:#a6e22e">createMarshaller</span>();   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Person person <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person();
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setFirstName</span>(<span style="color:#e6db74">&#34;Janko&#34;</span>);
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setLastName</span>(<span style="color:#e6db74">&#34;Ždiebik&#34;</span>);
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setDateOfBirth</span>(<span style="color:#66d9ef">new</span> Date(1972, 3, 2));
</span></span><span style="display:flex;"><span>person.<span style="color:#a6e22e">setWeight</span>(95);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>marshaller.<span style="color:#a6e22e">marshal</span>(person, System.<span style="color:#a6e22e">out</span>);
</span></span></code></pre></div><p>Rovnako sa zjednoduší aj deserializácia. Nemusíme totiž špecifikovať dátový typ a nemusíme ani vyťahovať osobu z <code>JAXBElement</code>u. Musíme len pretypovať výsledný <code>Object</code> na <code>Person</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>JAXBContext jaxbContext <span style="color:#f92672">=</span> JAXBContext.<span style="color:#a6e22e">newInstance</span>(Person.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>Unmarshaller unmarshaller <span style="color:#f92672">=</span> jaxbContext.<span style="color:#a6e22e">createUnmarshaller</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Reader reader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringReader(xmlPerson);
</span></span><span style="display:flex;"><span>Person person <span style="color:#f92672">=</span> (Person) unmarshaller.<span style="color:#a6e22e">unmarshal</span>(reader);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(person);
</span></span></code></pre></div><h1 id="generovanie-xml-schémy-z-existujúcich-tried">Generovanie XML schémy z existujúcich tried</h1>
<p>Na generovanie XML schémy z existujúcich tried jestvuje v referenčnej implementácii nástroj <code>schemagen</code>. Nájsť ho môžete v adresári <code>bin</code> v adresári, kam ste rozbalili JAXB.</p>
<p>Príklad použitia z príkazového riadku je nasledovný:</p>
<pre tabindex="0"><code>d:\Projects\jaxb&gt;set JAXB_HOME=C:\java\jaxb
d:\Projects\jaxb&gt;%JAXB_HOME\bin\schemagen src\jaxb\Person.java
Note: Writing d:\Projects\jaxb\schema1.xsd
</code></pre><p>Výsledná vygenerovaná schéma zodpovedajúca vyššie uvedenej triede vyzerá nasledovne:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;xs:schema</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.0&#34;</span> <span style="color:#a6e22e">xmlns:xs=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;xs:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;person&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;person&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;xs:complexType</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;person&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;xs:sequence&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;xs:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;dateOfBirth&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;xs:dateTime&#34;</span> 
</span></span><span style="display:flex;"><span>                  <span style="color:#a6e22e">minOccurs=</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;xs:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;firstName&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;xs:string&#34;</span> <span style="color:#a6e22e">minOccurs=</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;xs:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;lastName&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;xs:string&#34;</span> <span style="color:#a6e22e">minOccurs=</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;xs:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;weight&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;xs:float&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/xs:sequence&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/xs:complexType&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/xs:schema&gt;</span>
</span></span></code></pre></div><h1 id="generovanie-tried-z-dtd">Generovanie tried z DTD</h1>
<p>Ako experimentálnu alternatívu k XML schéme ponúka referenčná implementácia možnosť vygenerovať triedy zo súboru DTD. Ukážme si to na príklade DTD súboru k popisovaču nasadenia webových aplikácií (súboru <code>web.xml</code>). Vygenerujeme triedy, na ktoré namapujeme jednotlivé elementy takéhoto XML súboru:</p>
<pre tabindex="0"><code>d:\Projects\jaxb&gt;%JAXB_HOME%\bin\xjc -d src -p jaxb.servlet.config 
-dtd http://java.sun.com/dtd/web-app_2_3.dtd
</code></pre><p>Parameter <code>-d</code> určuje adresár, do ktorého sa vygenerujú zdrojové kódy tried. Pomocou <code>-p</code> nastavíme cieľový balíček (ak tento parameter vynecháme, balíček sa odvodí z URL adresy k DTD súboru). Parameter <code>-dtd</code> hovorí, že používame DTD súbor (namiesto štandardnej XML schémy). Posledný parameter udáva cestu k DTD súboru.</p>
<p>Program vygeneruje množstvo súborov:</p>
<pre tabindex="0"><code>parsing a schema...
compiling a schema...
jaxb\servlet\config\AuthConstraint.java
jaxb\servlet\config\AuthMethod.java
jaxb\servlet\config\ContextParam.java
jaxb\servlet\config\Description.java
...
jaxb\servlet\config\WebApp.java
jaxb\servlet\config\WebResourceCollection.java
jaxb\servlet\config\WebResourceName.java
jaxb\servlet\config\WelcomeFile.java
jaxb\servlet\config\WelcomeFileList.java
</code></pre><p>Proces serializácie a deserializácie je analogický ako v predošlých prípadoch. Rozdiel je však v spôsobe inicializácie kontextu. Namiesto jednej triedy môžeme uviesť názov balíčka, ktorého triedy chceme (de)serializovať.</p>
<p>Následne vytvoríme <code>Unmarshaller</code> klasickým spôsobom. Koreňovému elementu XML súboru, ktorým je <code>&lt;web-app&gt;</code> zodpovedá trieda <code>WebApp</code>, a práve túto triedu budeme potrebovať pri deserializácii XML dokumentu. V príklade deserializujeme dáta z XML súboru na disku.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>JAXBContext jaxbContext <span style="color:#f92672">=</span>   
</span></span><span style="display:flex;"><span>  JAXBContext.<span style="color:#a6e22e">newInstance</span>(<span style="color:#e6db74">&#34;jaxb.servlet.config&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Unmarshaller unmarshaller <span style="color:#f92672">=</span> jaxbContext.<span style="color:#a6e22e">createUnmarshaller</span>();
</span></span><span style="display:flex;"><span>File xmlFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File(<span style="color:#e6db74">&#34;web.xml&#34;</span>)
</span></span><span style="display:flex;"><span>WebApp webApp <span style="color:#f92672">=</span> (WebApp) unmarshaller.<span style="color:#a6e22e">unmarshal</span>(xmlFile);
</span></span></code></pre></div><p>Následne môžeme pracovať s triedami klasickým spôsobom. Napr. deklaráciu nového servletu pridáme do webovej aplikácie nasledovne:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Servlet servlet <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Servlet();
</span></span><span style="display:flex;"><span>ServletName servletName <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServletName();
</span></span><span style="display:flex;"><span>servletName.<span style="color:#a6e22e">setvalue</span>(<span style="color:#e6db74">&#34;HelloServlet&#34;</span>);
</span></span><span style="display:flex;"><span>servlet.<span style="color:#a6e22e">setServletName</span>(servletName);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>webApp.<span style="color:#a6e22e">getServlet</span>().<span style="color:#a6e22e">add</span>(servlet);
</span></span></code></pre></div><p>Spätnú serializáciu (v tomto prípade na konzolu) dosiahneme tiež klasickým spôsobom, zavolaním metódy <code>marshall()</code> nad objektom typu <code>WebApp</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Marshaller marshaller <span style="color:#f92672">=</span> jaxbContext.<span style="color:#a6e22e">createMarshaller</span>();
</span></span><span style="display:flex;"><span>marshaller.<span style="color:#a6e22e">marshal</span>(webApp, System.<span style="color:#a6e22e">out</span>);
</span></span></code></pre></div><h1 id="odkazy">Odkazy</h1>
<h2 id="webové-odkazy">Webové odkazy</h2>
<ul>
<li><a href="https://jaxb.dev.java.net/">Referenčná implementácia JAXB</a></li>
<li><a href="http://java.sun.com/javase/6/docs/api/javax/xml/bind/package-summary.html">JavaDoc </a> k JAXB</li>
<li><a href="http://java.sun.com/developer/technicalArticles/WebServices/jaxb/">Java Architecture for XML Binding</a> - základný článok na java.sun.com</li>
<li><a href="http://java.sun.com/javaee/5/docs/tutorial/doc/bnazf.html">Binding between XML Schema and Java Classes </a> - Java EE 5 Tutorial</li>
<li><a href="http://javaboutique.internet.com/tutorials/jaxb/index4.html">Improved XML Binding with JAXB 2.0</a> - náhľad na technológiu na Java Boutique</li>
<li><a href="http://www.regdeveloper.co.uk/2006/09/22/jaxb2_guide/">A practical guide to JAXB 2.0</a> - tutoriál k práci s JAXB 2.0 v Eclipse</li>
<li><a href="http://www.w3.org/TR/xmlschema-0/">Špecifikácia k &lsquo;&lsquo;XML Schema&rsquo;&rsquo;</a></li>
</ul>
<h2 id="iné-podobné-projekty">Iné podobné projekty</h2>
<ul>
<li><a href="http://www.castor.org">Castor</a> - mapovanie medzi XML, Java triedami a SQl tabuľkami</li>
<li><a href="http://xstream.codehaus.org/">XStream</a> - jednoduchý nástroj na serializáciu objektov do XML a späť</li>
</ul>

    <a href="/"> >> Home</a>
  </main>
</div>
    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

      
    </footer>
  </body>
</html>

